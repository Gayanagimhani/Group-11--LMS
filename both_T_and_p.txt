-- Theory Attendance Only

CREATE OR REPLACE VIEW V_Theory_Attendance AS
SELECT 
    a.Reg_no,
    at.Course_id,
    c.Course_name,
    'Theory' AS Session_Type,
    COUNT(*) AS Total_Sessions,
    SUM(CASE WHEN at.Attendance_status = 'Present' THEN 1 ELSE 0 END) AS Attended,
    ROUND(
        (SUM(CASE WHEN at.Attendance_status = 'Present' THEN 1 ELSE 0 END) / COUNT(*)) * 100, 2
    ) AS Percentage
FROM ATTENDANCE at
JOIN COURSE_UNIT c ON at.Course_id = c.Course_id
JOIN STUDENT a ON at.Reg_no = a.Reg_no
WHERE at.Session_type = 'Theory'
GROUP BY a.Reg_no, at.Course_id, c.Course_name;

SELECT * FROM V_Theory_Attendance
WHERE Course_id = 'ICT1233';

-- Practical Attendance Only

CREATE OR REPLACE VIEW V_Practical_Attendance AS
SELECT 
    a.Reg_no,
    at.Course_id,
    c.Course_name,
    'Practical' AS Session_Type,
    COUNT(*) AS Total_Sessions,
    SUM(CASE WHEN at.Attendance_status = 'Present' THEN 1 ELSE 0 END) AS Attended,
    ROUND(
        (SUM(CASE WHEN at.Attendance_status = 'Present' THEN 1 ELSE 0 END) / COUNT(*)) * 100, 2
    ) AS Percentage
FROM ATTENDANCE at
JOIN COURSE_UNIT c ON at.Course_id = c.Course_id
JOIN STUDENT a ON at.Reg_no = a.Reg_no
WHERE at.Session_type = 'Practical'
GROUP BY a.Reg_no, at.Course_id, c.Course_name;

SELECT * FROM V_Practical_Attendance
WHERE Course_id = 'ICT1233';